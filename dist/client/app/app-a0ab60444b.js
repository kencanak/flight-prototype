"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}angular.module("thoughtworksTestApp",["thoughtworksTestApp.constants","ngCookies","ngResource","ngSanitize","ui.router","ngMaterial","ngAnimate"]).config(["$urlRouterProvider","$locationProvider","$mdDateLocaleProvider",function(e,t,r){e.otherwise("/"),t.html5Mode(!0),r.formatDate=function(e){return moment(e).format("DD MMM YYYY")},r.parseDate=function(e){var t=moment(e,"DD MMM YYYY",!0);return t.isValid()?t.toDate():new Date}}]),angular.module("thoughtworksTestApp.util",[]),function(e,t){e.module("thoughtworksTestApp.constants",[]).constant("appConfig",{userRoles:["guest","user","admin"]})}(angular);var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(){var e=function(){function e(t,r,n){_classCallCheck(this,e),this.$http=t,this.$window=r,this.screenStatus={smallScreen:r.innerWidth<960,hasResult:!1},this.$scope=n}return e.$inject=["$http","$window","$scope"],_createClass(e,[{key:"$onInit",value:function(){var e=this;angular.element(e.$window).bind("resize",function(){e.screenStatus.smallScreen=e.$window.innerWidth<960,e.$scope.$digest()}),e.$scope.$on("new-search",function(t,r){r?e.screenStatus.hasResult=!0:e.screenStatus.hasResult=!1})}}]),e}();angular.module("thoughtworksTestApp").component("main",{templateUrl:"app/main/main.html",controller:e,mainController:"mainController"})}(),angular.module("thoughtworksTestApp").config(["$stateProvider",function(e){e.state("main",{url:"/",template:"<main></main>"})}]);var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),ResultsController=function(){function e(t,r,n){_classCallCheck(this,e),this.errors={},this.$state=t,this.$scope=r,this.results=[],this.minDate=new Date,this.Trips=n,this.allTrips=[],this.tripDetails={from:"",fromCode:"",to:"",toCode:"","return":!0,departDate:this.minDate,returnDate:moment(this.minDate).add(5,"days").toDate(),passengers:1,priceMax:200}}return e.$inject=["$state","$scope","Trips"],_createClass(e,[{key:"$onInit",value:function(){var e=this;e.Trips.get().$promise.then(function(t){e.allTrips=t.data}),e.$scope.$on("new-search",function(t,r){if(r){if(!r.fromCode&&!r.toCode&&!r.departDate)return!1;e.results=[],angular.copy(r,e.tripDetails),e.queryTrips()}})}},{key:"queryTrips",value:function(){var e=this,t=e.allTrips.filter(e.searchFilter(e.tripDetails.departDate,e.tripDetails.fromCode,e.tripDetails.toCode)),r=[];if(e.tripDetails["return"]&&(r=e.allTrips.filter(e.searchFilter(e.tripDetails.returnDate,e.tripDetails.toCode,e.tripDetails.fromCode))),t.length>0)for(var n=0;n<t.length;n++){var s={};s.depart=t[n];var a=parseInt(s.depart.price);if(e.tripDetails["return"]&&0===r.length)break;for(var l=0;l<r.length;l++)s["return"]=r[l],a+=parseInt(s["return"].price);s.price=a,(e.tripDetails["return"]&&a<=e.tripDetails.priceMax||!e.tripDetails["return"])&&e.results.push(s)}}},{key:"searchFilter",value:function(e,t,r){var n=this;return function(s){var a=n.compareDate(s.timings.day,e)&&s.airport_details.from===t&&s.airport_details.to===r&&parseInt(s.price)<=n.tripDetails.priceMax;return a}}},{key:"compareDate",value:function(e,t){return e=moment(e).toDate().setHours(0,0,0,0),t=moment(t).toDate().setHours(0,0,0,0),e===t}},{key:"newSearch",value:function(){this.$scope.$emit("new-search",null)}},{key:"formatDate",value:function(e){return moment(e).format("DD MMM YYYY")}}]),e}();angular.module("thoughtworksTestApp").controller("ResultsController",ResultsController),angular.module("thoughtworksTestApp").directive("results",function(){return{templateUrl:"components/results/results.html",restrict:"E",controller:"ResultsController",controllerAs:"resultsController"}});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),SearchController=function(){function e(t,r,n){_classCallCheck(this,e),this.errors={},this.$state=t,this.$scope=r,this.airportsData=[],this.Airports=n,this.minDate=new Date,this.maxPassengers=new Array(8),this.tripDetails={from:"",fromCode:"",to:"",toCode:"","return":!0,departDate:this.minDate,returnDate:moment(this.minDate).add(5,"days").toDate(),passengers:1,priceMax:200},this.sliderValue=this.tripDetails.priceMax}return e.$inject=["$state","$scope","Airports"],_createClass(e,[{key:"$onInit",value:function(){var e=this;e.Airports.get().$promise.then(function(t){for(var r=0;r<t.data.length;r++)e.airportsData.push({value:t.data[r].code,display:t.data[r].city+" ("+t.data[r].code+")"})}),e.$scope.$watch(function(){return e.sliderValue},function(t,r){t!==r&&(e.tripDetails.priceMax=e.sliderValue,e.beginSearch())})}},{key:"selectAirport",value:function(e,t){var r=this,n="";e&&(n=e.value),r.tripDetails[t+"Code"]=n}},{key:"queryAirports",value:function(e,t){var r=this;return r.airportsData.filter(r.searchFilter(e,t))}},{key:"searchFilter",value:function(e,t){var r=this,n=angular.lowercase(e);return function(e){var s=angular.lowercase(e.display);return 0===s.indexOf(n)&&s!==angular.lowercase(r.tripDetails[t])}}},{key:"toggleTrip",value:function(){this.tripDetails["return"]=!this.tripDetails["return"]}},{key:"beginSearch",value:function(){this.$scope.$emit("new-search",this.tripDetails)}}]),e}();angular.module("thoughtworksTestApp").controller("SearchController",SearchController),angular.module("thoughtworksTestApp").directive("search",function(){return{templateUrl:"components/search/search.html",restrict:"E",controller:"SearchController",controllerAs:"searchController"}}),function(){function e(e){return e("assets/dummy-data/airports.json")}e.$inject=["$resource"],angular.module("thoughtworksTestApp").factory("Airports",e)}(),function(){function e(e){return e("assets/dummy-data/trips.json")}e.$inject=["$resource"],angular.module("thoughtworksTestApp").factory("Trips",e)}(),function(){function e(e){var t={safeCb:function(e){return angular.isFunction(e)?e:angular.noop},urlParse:function(e){var t=document.createElement("a");return t.href=e,""===t.host&&(t.href=t.href),t},isSameOrigin:function(r,n){return r=t.urlParse(r),n=n&&[].concat(n)||[],n=n.map(t.urlParse),n.push(e.location),n=n.filter(function(e){var t=r.hostname===e.hostname,n=r.protocol===e.protocol,s=r.port===e.port||""===e.port&&("80"===r.port||"443"===r.port);return t&&n&&s}),n.length>=1}};return t}e.$inject=["$window"],angular.module("thoughtworksTestApp.util").factory("Util",e)}(),angular.module("thoughtworksTestApp").run(["$templateCache",function(e){e.put("app/main/main.html",'<header>\n  <h3>Flight Search Engine</h3>\n</header>\n<div class="container-wrapper">\n  <div class="row" ng-class="$ctrl.hasResult ? \'has-result\' : \'\'">\n      <search class="left-panel col slide-in" ng-show="(!$ctrl.screenStatus.hasResult && $ctrl.screenStatus.smallScreen) || !$ctrl.screenStatus.smallScreen"></search>\n      <results class="right-panel col slide-in" ng-show="($ctrl.screenStatus.hasResult && $ctrl.screenStatus.smallScreen) || !$ctrl.screenStatus.smallScreen"></results>\n  </div>\n</div>\n'),e.put("components/results/results.html",'<div class="row trip-details-mobile" id="trip-details-mobile">\n  <div class="row">\n    <div class="col search-details">\n      <p>\n        <span class="label">From:</span>\n        <span class="content">{{resultsController.tripDetails.from}}</span>\n      </p>\n      <p>\n        <span class="label">To:</span>\n        <span class="content">{{resultsController.tripDetails.to}}</span>\n      </p>\n      <p>\n        <span class="label">Passenger(s):</span>\n        <span class="content">{{resultsController.tripDetails.passengers}}</span>\n      </p>\n      <p>\n        <span class="label">Price Range:</span>\n        <span class="content">£ 0 - £ {{resultsController.tripDetails.priceMax}}</span>\n      </p>\n    </div>\n    <div class="col trip-details">\n      <p>\n        <span class="label">Depart:</span>\n        <span class="content">{{resultsController.formatDate(resultsController.tripDetails.departDate)}}</span>\n      </p>\n      <p ng-show="resultsController.tripDetails.return">\n        <span class="label">Return:</span>\n        <span class="content">{{resultsController.formatDate(resultsController.tripDetails.returnDate)}}</span>\n      </p>\n    </div>\n  </div>\n  <div class="row">\n    <button ng-click="resultsController.newSearch()">Refine Your Search</button>\n  </div>\n</div>\n<div class="results-wrapper">\n  <div class="row title web">\n    <h5>Your Results</h5>\n    <div class="trip-details">\n      <p>\n        <span class="label">Depart:</span>\n        <span class="content">{{resultsController.formatDate(resultsController.tripDetails.departDate)}}</span>\n      </p>\n      <p ng-show="resultsController.tripDetails.return">\n        <span class="label">Return:</span>\n        <span class="content">{{resultsController.formatDate(resultsController.tripDetails.returnDate)}}</span>\n      </p>\n    </div>\n  </div>\n\n  <div class="row title mobile">\n    <h5>Your Results</h5>\n  </div>\n  <div class="row results" ng-show="resultsController.results.length === 0">\n    <p class="message">Sorry, we didn\'t quite get your query. Please kindly refine your search query.</p>\n  </div>\n  <div class="row results" ng-show="resultsController.results.length > 0">\n\n    <div class="result-box" ng-repeat="trip in resultsController.results">\n      <div class="col thumbnail">\n        <div>\n          <span>\n            <img src="{{trip.depart.flight_details.image}}"/>\n          </span>\n        </div>\n      </div>\n      <div class="col flight-details" ng-class="!trip.return ? \'double-col\' : \'\'">\n        <div class="row flight-code note">\n          {{trip.depart.flight_details.code}}\n        </div>\n        <div class="row flight-route">\n          {{trip.depart.airport_details.from}} > {{trip.depart.airport_details.to}}\n        </div>\n        <div class="row trip-details note">\n          <p>\n            <span class="label">Depart:</span>\n            <span class="content">{{trip.depart.timings.depart_time}}</span>\n          </p>\n          <p>\n            <span class="label">Arrive:</span>\n            <span class="content">{{trip.depart.timings.arrive_time}}</span>\n          </p>\n        </div>\n      </div>\n      <div class="col flight-details" ng-show="trip.return">\n        <div class="row flight-code note">\n          {{trip.return.flight_details.code}}\n        </div>\n        <div class="row flight-route">\n          {{trip.return.airport_details.from}} > {{trip.return.airport_details.to}}\n        </div>\n        <div class="row trip-details note">\n          <p>\n            <span class="label">Depart:</span>\n            <span class="content">{{trip.return.timings.depart_time}}</span>\n          </p>\n          <p>\n            <span class="label">Arrive:</span>\n            <span class="content">{{trip.return.timings.arrive_time}}</span>\n          </p>\n        </div>\n      </div>\n      <div class="col flight-price">\n        <span>\n          £ {{trip.price}}\n        </span>\n      </div>\n      <div class="col flight-action">\n        <span>\n          <button>Select this flight</button>\n        </span>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("components/search/search.html",'<div class="search-toolbox">\n  <div class="row toolbox">\n    <div class="row trip-toggle">\n      <div class="col" ng-click="searchController.toggleTrip()" ng-class="!searchController.tripDetails.return ? \'selected\': \'\'">\n        One Way\n      </div>\n      <div class="col" ng-click="searchController.toggleTrip()" ng-class="searchController.tripDetails.return ? \'selected\': \'\'">\n        Return\n      </div>\n    </div>\n    <div class="row">\n      <label>From</label>\n      <md-autocomplete\n            md-no-cache="true"\n            md-search-text="searchController.tripDetails.from"\n            md-selected-item-change="searchController.selectAirport(item, \'from\')"\n            md-items="item in searchController.queryAirports(searchController.tripDetails.from, \'to\')"\n            md-item-text="item.display"\n            md-min-length="0"\n            placeholder="From">\n          <md-item-template>\n            <span md-highlight-text="searchController.tripDetails.from" md-highlight-flags="^i">{{item.display}}</span>\n          </md-item-template>\n          <md-not-found>\n            No results matching "{{searchController.tripDetails.from}}" were found.\n          </md-not-found>\n        </md-autocomplete>\n    </div>\n    <div class="row">\n      <label>To</label>\n      <md-autocomplete\n            md-no-cache="true"\n            md-search-text="searchController.tripDetails.to"\n            md-selected-item-change="searchController.selectAirport(item, \'to\')"\n            md-items="item in searchController.queryAirports(searchController.tripDetails.to, \'from\')"\n            md-item-text="item.display"\n            md-min-length="0"\n            placeholder="To">\n          <md-item-template>\n            <span md-highlight-text="searchController.tripDetails.to" md-highlight-flags="^i">{{item.display}}</span>\n          </md-item-template>\n          <md-not-found>\n            No results matching "{{searchController.tripDetails.to}}" were found.\n          </md-not-found>\n        </md-autocomplete>\n    </div>\n    <div class="row">\n      <label>Departure Date</label>\n      <md-datepicker ng-model="searchController.tripDetails.departDate" md-placeholder="dd/mm/yyyy"\n        md-min-date="searchController.minDate"></md-datepicker>\n    </div>\n    <div class="row" ng-class="!searchController.tripDetails.return ? \'fade-out\': \'fade-in\'">\n      <label>Return Date</label>\n      <md-datepicker ng-model="searchController.tripDetails.returnDate" md-placeholder="dd/mm/yyyy"\n        md-min-date="searchController.minDate"></md-datepicker>\n    </div>\n    <div class="row">\n      <label>Passenger(s)</label>\n      <md-select ng-model="searchController.tripDetails.passengers">\n          <md-option ng-repeat="i in searchController.maxPassengers track by $index" value="{{$index + 1}}">\n            {{$index + 1}}\n          </md-option>\n        </md-select>\n    </div>\n    <div class="row">\n      <button ng-click="searchController.beginSearch()">Search</button>\n    </div>\n  </div>\n  <div class="row toolbox">\n    <div class="row">\n      <label>Refine Flight Search</label>\n      <div class="row pricing-range">\n        <span class="left">£ 0</span>\n        <span class="right">£ 200</span>\n      </div>\n      <div class="row pricing-slider">\n        <md-slider ng-model="searchController.sliderValue" flex md-discrete step="10" min="0" max="200">\n        </md-slider>\n      </div>\n    </div>\n  </div>\n</div>\n')}]);